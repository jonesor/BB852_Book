--- 
title: "BB852 - Data handling, visualisation and statistics"
author: "Owen R. Jones"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
pandoc_args: --listings
output:
  bookdown::gitbook:
    config:
      toc:
        collapse: section
    includes:
      in_header: extras.css
  bookdown::pdf_book:
    includes:
      in_header: preamble.tex
    papersize: a4
  pdf_document:
    includes:
      in_header: preamble.tex
classoption: a4paper
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
description: "Course book for BB852 at the Biology Department, University of Southern Denmark"

---

```{r setOptions, include=FALSE}
knitr::opts_chunk$set(
  warning = FALSE, message = FALSE
)
set.seed(183975)
```

# Preface

This book has been written to accompany the course, *BB852 - Data Handling, Visualisation and Statistics*.

It is available as a website (https://jonesor.github.io/BB852_Book/) or as a PDF (click the link at the top of book's website). I recommend to use the website where possible because the formatting is sometimes messy on the PDF, but the PDF is useful if you want a copy for offline use.

```{block, type="do-something"}
**Note:** The book is a "work in progress" and will change during the course. The latest version can always be found at the website, or by downloading it again. 
Please let me know ([jones@biology.sdu.dk](mailto:jones@biology.sdu.dk)) if you spot any errors, or have any suggestions for improvement.
```

The book is divided into three parts: data wrangling, data visualisation and statistics.

## Data wrangling

The term data wrangling covers manipulation of data, for example collected from an experiment or observational study, from its raw form to a form that is ready for analysis, or summarised into tables. It includes reshaping, transforming, filtering and augmenting from other data. This book covers these processes in R mainly using the tools from the `dplyr` package.

## Data visualisation

Graphing data is a crucial analytical step that can both highlight problems with the data (e.g. errors and outliers) and can inform on appropriate statistical approaches to take. This book covers the use of `ggplot2` to make high quality, publication-ready plots.

## Statistics

Statistics is a *huge* field and this book does not attempt to cover more than a small fraction of it. Instead it focusses on (ordinary) linear models and generalised linear models. In a nutshell, linear models model the effects of explanatory variables on a continuous response variable with a gaussian (normal) error distribution while generalised linear models (GLMs) offer a more flexible approach that allows the response variable to have non-normal error distributions. This flexibility allows the more-appropriate modelling of phenomena including integer counts (e.g. number of individuals, or species, or events), binary (0/1) data (e.g. survived/died) or binomial count data (e.g. counts of successess and failures). It is important to realise that most commonly-used statistical methods including t-tests, ANOVA, ANCOVA, n-way ANOVA, and of course linear and multiple regression are all special cases of linear models. 

My general approach with communicating these methods and ideas is to teach using examples. Therefore, the bulk of the text here consists of walk-throughs of manipulating, plotting and analysing real data. For the statistics section I focus on communicating the "gist" of the underlying mathematical machinery rather than the mathematical details. If you find yourself interested in these details then there are more specialist textbooks available. 


```{block, type="do-something"}
This book accompanies the course lectures. The general idea is that there will be a lecture, followed by computer work where you work  through the examples in the relevant chapter of this book. At the end of most chapters there are also exercises to test your new skills. It is very important that you do these to gradually build up your skill level and confidence.
```

## Data sources

This book uses numerous data sets in examples, most of which are real datasets obtained from published works, or collected by me.

The data sets can be found at the following link:
https://www.dropbox.com/sh/z8iv9fl9l00bm0w/AAD1WjFwcrr1ERugpunp_YH-a?dl=0

## Your instructors

You are welcome to contact us with any problems/questions (but please put a little effort in first).

*	[Owen Jones](https://portal.findresearcher.sdu.dk/en/persons/jones), Associate Professor, jones@biology.sdu.dk 
*	[John Jackson](https://jjacksoneco.wordpress.com), Postdoc, johnja@biology.sdu.dk 

## Acknowledgements

These materials are inspired by the excellent textbook, "Getting Started With R"^[Beckerman, Childs & Petchey (2017) *Getting Started With R*. Oxford University Press (2nd edition)], which is the recommended textbook for BB852, and by materials for the Sheffield University course "AP 240 - Data Analysis And Statistics With R" ([https://dzchilds.github.io/stats-for-bio/]). For your convenience, the datasets for the Beckerman et al. book are available at this course's data Dropbox link (above), in a folder called "GSWR_datasets".


```{r which datasets imported, echo = FALSE, message=FALSE}
rmdFiles <- list.files(pattern = "*.Rmd")

dataSetsUsed <- NULL

for (i in 1:length(rmdFiles)){
  x1 <- readLines(rmdFiles[i])
  csvLines <- grep("[_A-Za-z0-9]+\\.csv",x1)
  dataSetsUsed <- append(dataSetsUsed,x1[csvLines])
}

dataSetsUsed<-unique(dataSetsUsed)

library(stringr)
dataSetsUsed <- unlist(str_extract_all(dataSetsUsed, "([A-Za-z0-9_]+\\.csv)")) %>% 
  sort() %>% 
  unique()
dataSetsUsed <- data.frame(name = c(dataSetsUsed,"GSWR_datasets")) %>% 
  filter(!name %in% c("write.csv","read.csv","dataSetsUsed.csv","dataSetsMissing.csv"))

write.csv(x = dataSetsUsed,file = "dataSetsUsed.csv",row.names = FALSE)

#list.files
currentFiles <- list.files(path = "CourseData/")
delFiles <- paste0("CourseData/",currentFiles[which(!currentFiles %in% dataSetsUsed$name)])
delFiles

#Missing files
missingFiles <- dataSetsUsed$name[!dataSetsUsed$name %in% currentFiles]
dataSetsMissing <- data.frame(name = missingFiles) %>% 
  filter(!name %in% c("SDUweather.csv"))
write.csv(x = dataSetsMissing,file = "dataSetsMissing.csv",row.names = FALSE)

#Remove files that are not mentioned in the course.
if(!delFiles[1] == "CourseData/"){
file.remove(delFiles)
}
```


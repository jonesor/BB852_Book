<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Chapter 4 Combining data sets | BB852 - Data handling, visualisation and statistics" />
<meta property="og:type" content="book" />


<meta property="og:description" content="This is the course book for BB852." />


<meta name="author" content="Owen Jones" />

<meta name="date" content="2020-08-26" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<meta name="description" content="This is the course book for BB852.">

<title>Chapter 4 Combining data sets | BB852 - Data handling, visualisation and statistics</title>

<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#preface"><span class="toc-section-number">1</span> Preface</a>
<ul>
<li><a href="1-1-data-wrangling.html#data-wrangling"><span class="toc-section-number">1.1</span> Data wrangling</a></li>
<li><a href="1-2-data-visualisation.html#data-visualisation"><span class="toc-section-number">1.2</span> Data visualisation</a></li>
<li><a href="1-3-statistics.html#statistics"><span class="toc-section-number">1.3</span> Statistics</a></li>
<li><a href="1-4-general-approach.html#general-approach"><span class="toc-section-number">1.4</span> General approach</a></li>
<li><a href="1-5-data-sources.html#data-sources"><span class="toc-section-number">1.5</span> Data sources</a></li>
<li><a href="1-6-acknowledgements.html#acknowledgements"><span class="toc-section-number">1.6</span> Acknowledgements</a></li>
<li><a href="1-7-error-reporting.html#error-reporting"><span class="toc-section-number">1.7</span> Error reporting</a></li>
</ul></li>
<li><a href="2-getting-acquainted-with-r.html#getting-acquainted-with-r"><span class="toc-section-number">2</span> Getting acquainted with R</a>
<ul>
<li><a href="2-1-introduction.html#introduction"><span class="toc-section-number">2.1</span> Introduction</a></li>
<li><a href="2-2-getting-started-with-r.html#getting-started-with-r"><span class="toc-section-number">2.2</span> Getting started with R</a></li>
<li><a href="2-3-getting-help.html#getting-help"><span class="toc-section-number">2.3</span> Getting help</a></li>
<li><a href="2-4-r-as-a-fancy-calculator.html#r-as-a-fancy-calculator"><span class="toc-section-number">2.4</span> R as a fancy calculator</a></li>
<li><a href="2-5-objects-in-r.html#objects-in-r"><span class="toc-section-number">2.5</span> Objects in R</a></li>
<li><a href="2-6-missing-values-infinity-and-non-numbers.html#missing-values-infinity-and-non-numbers"><span class="toc-section-number">2.6</span> Missing values, infinity and “non-numbers”</a></li>
<li><a href="2-7-basic-information-about-objects.html#basic-information-about-objects"><span class="toc-section-number">2.7</span> Basic information about objects</a></li>
<li><a href="2-8-data-frames.html#data-frames"><span class="toc-section-number">2.8</span> Data frames</a></li>
<li><a href="2-9-classes-in-r.html#classes-in-r"><span class="toc-section-number">2.9</span> Classes in R</a></li>
<li><a href="2-10-tables-and-summary-statistics.html#tables-and-summary-statistics"><span class="toc-section-number">2.10</span> Tables and summary statistics</a></li>
<li><a href="2-11-plotting-data.html#plotting-data"><span class="toc-section-number">2.11</span> Plotting data</a></li>
<li><a href="2-12-exercises-getting-acquainted-with-r.html#exercises---getting-acquainted-with-r"><span class="toc-section-number">2.12</span> Exercises - Getting acquainted with R</a>
<ul>
<li><a href="2-12-exercises-getting-acquainted-with-r.html#background"><span class="toc-section-number">2.12.1</span> Background</a></li>
<li><a href="2-12-exercises-getting-acquainted-with-r.html#the-data"><span class="toc-section-number">2.12.2</span> The data</a></li>
<li><a href="2-12-exercises-getting-acquainted-with-r.html#try-the-following"><span class="toc-section-number">2.12.3</span> Try the following</a></li>
<li><a href="2-12-exercises-getting-acquainted-with-r.html#references"><span class="toc-section-number">2.12.4</span> References</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Data Wrangling</b></span></li>
<li><a href="3-data-wrangling-with-dplyr.html#data-wrangling-with-dplyr"><span class="toc-section-number">3</span> Data wrangling with dplyr</a>
<ul>
<li><a href="2-1-introduction.html#introduction"><span class="toc-section-number">3.1</span> Introduction</a></li>
<li><a href="3-2-select.html#select"><span class="toc-section-number">3.2</span> select</a></li>
<li><a href="3-3-filter.html#filter"><span class="toc-section-number">3.3</span> filter</a></li>
<li><a href="3-4-arrange.html#arrange"><span class="toc-section-number">3.4</span> arrange</a></li>
<li><a href="3-5-summarise-and-group-by.html#summarise-and-group_by"><span class="toc-section-number">3.5</span> summarise and group_by</a></li>
<li><a href="3-6-using-pipes-saving-data-.html#using-pipes-saving-data."><span class="toc-section-number">3.6</span> Using pipes, saving data.</a></li>
<li><a href="3-7-exercises-data-wrangling.html#exercises---data-wrangling"><span class="toc-section-number">3.7</span> Exercises - data wrangling</a>
<ul>
<li><a href="3-7-exercises-data-wrangling.html#exploring-the-amniote-life-history-database"><span class="toc-section-number">3.7.1</span> Exploring the Amniote Life History Database</a></li>
</ul></li>
</ul></li>
<li><a href="4-combining-data-sets.html#combining-data-sets"><span class="toc-section-number">4</span> Combining data sets</a>
<ul>
<li><a href="4-1-exercise-joining-datasets.html#exercise---joining-datasets"><span class="toc-section-number">4.1</span> Exercise - joining datasets</a>
<ul>
<li><a href="2-12-exercises-getting-acquainted-with-r.html#the-data"><span class="toc-section-number">4.1.1</span> The data</a></li>
<li><a href="4-1-exercise-joining-datasets.html#the-bird-data"><span class="toc-section-number">4.1.2</span> The bird data</a></li>
<li><a href="4-1-exercise-joining-datasets.html#the-weather-data"><span class="toc-section-number">4.1.3</span> The weather data</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Data visualisation</b></span></li>
<li><a href="5-visualising-data-with-ggplot2.html#visualising-data-with-ggplot2"><span class="toc-section-number">5</span> Visualising data with ggplot2</a>
<ul>
<li><a href="2-1-introduction.html#introduction"><span class="toc-section-number">5.1</span> Introduction</a></li>
<li><a href="5-2-histograms.html#histograms"><span class="toc-section-number">5.2</span> Histograms</a></li>
<li><a href="5-3-facets-splitting-data-across-panels.html#facets---splitting-data-across-panels"><span class="toc-section-number">5.3</span> “Facets” - splitting data across panels</a></li>
<li><a href="5-4-box-plots.html#box-plots"><span class="toc-section-number">5.4</span> box plots</a></li>
<li><a href="5-5-lines-and-points.html#lines-and-points"><span class="toc-section-number">5.5</span> lines and points</a></li>
<li><a href="5-6-scatter-plot.html#scatter-plot"><span class="toc-section-number">5.6</span> scatter plot</a></li>
</ul></li>
<li><a href="6-distributions-and-summarising-data.html#distributions-and-summarising-data"><span class="toc-section-number">6</span> Distributions and summarising data</a>
<ul>
<li><a href="2-1-introduction.html#introduction"><span class="toc-section-number">6.1</span> Introduction</a></li>
<li><a href="6-2-distributions.html#distributions"><span class="toc-section-number">6.2</span> Distributions</a></li>
<li><a href="6-3-normal-distribution.html#normal-distribution"><span class="toc-section-number">6.3</span> Normal distribution</a></li>
<li><a href="6-4-compare-normal-distributions.html#compare-normal-distributions"><span class="toc-section-number">6.4</span> Compare normal distributions</a></li>
<li><a href="6-5-the-poisson-distribution.html#the-poisson-distribution"><span class="toc-section-number">6.5</span> The Poisson distribution</a></li>
<li><a href="6-6-comparing-normal-and-poisson-distributions.html#comparing-normal-and-poisson-distributions"><span class="toc-section-number">6.6</span> Comparing normal and Poisson distributions</a></li>
</ul></li>
<li><a href="7-customising-your-plots.html#customising-your-plots"><span class="toc-section-number">7</span> Customising your plots</a>
<ul>
<li><a href="2-1-introduction.html#introduction"><span class="toc-section-number">7.1</span> Introduction</a></li>
<li><a href="7-2-a-basic-plot.html#a-basic-plot"><span class="toc-section-number">7.2</span> A basic plot</a></li>
<li><a href="7-3-axis-limits.html#axis-limits"><span class="toc-section-number">7.3</span> Axis limits</a></li>
<li><a href="7-4-transforming-the-axis-log-scale.html#transforming-the-axis-log-scale"><span class="toc-section-number">7.4</span> Transforming the axis (log scale)</a></li>
<li><a href="7-5-changing-the-axis-tick-marks.html#changing-the-axis-tick-marks"><span class="toc-section-number">7.5</span> Changing the axis tick marks</a></li>
<li><a href="7-6-axis-labels.html#axis-labels"><span class="toc-section-number">7.6</span> Axis labels</a></li>
<li><a href="7-7-colours.html#colours"><span class="toc-section-number">7.7</span> Colours</a></li>
<li><a href="7-8-themes.html#themes"><span class="toc-section-number">7.8</span> Themes</a></li>
<li><a href="7-9-moving-the-legend.html#moving-the-legend"><span class="toc-section-number">7.9</span> Moving the legend</a></li>
<li><a href="7-10-combining-multiple-plots.html#combining-multiple-plots"><span class="toc-section-number">7.10</span> Combining multiple plots</a></li>
<li><a href="7-11-saving-your-plot.html#saving-your-plot"><span class="toc-section-number">7.11</span> Saving your plot</a></li>
<li><a href="7-12-final-word-on-plots.html#final-word-on-plots"><span class="toc-section-number">7.12</span> Final word on plots</a></li>
</ul></li>
<li class="part"><span><b>III Statistics</b></span></li>
<li><a href="8-randomisation-tests.html#randomisation-tests"><span class="toc-section-number">8</span> Randomisation Tests</a>
<ul>
<li><a href="2-1-introduction.html#introduction"><span class="toc-section-number">8.1</span> Introduction</a></li>
<li><a href="8-2-the-example.html#the-example"><span class="toc-section-number">8.2</span> The example</a></li>
<li><a href="8-3-setting-up.html#setting-up"><span class="toc-section-number">8.3</span> Setting up</a></li>
<li><a href="8-4-calculate-the-observed-difference.html#calculate-the-observed-difference"><span class="toc-section-number">8.4</span> Calculate the observed difference</a></li>
<li><a href="8-5-null-distribution.html#null-distribution"><span class="toc-section-number">8.5</span> Null distribution</a></li>
<li><a href="8-6-testing-significance.html#testing-significance"><span class="toc-section-number">8.6</span> Testing significance</a></li>
<li><a href="8-7-testing-the-hypothesis.html#testing-the-hypothesis"><span class="toc-section-number">8.7</span> Testing the hypothesis</a></li>
<li><a href="8-8-writing-it-up.html#writing-it-up"><span class="toc-section-number">8.8</span> Writing it up</a></li>
<li><a href="8-9-paired-randomisation-tests.html#paired-randomisation-tests"><span class="toc-section-number">8.9</span> Paired Randomisation Tests</a>
<ul>
<li><a href="8-9-paired-randomisation-tests.html#plot-the-data"><span class="toc-section-number">8.9.1</span> Plot the data</a></li>
<li><a href="8-9-paired-randomisation-tests.html#the-paired-randomisation-test"><span class="toc-section-number">8.9.2</span> The paired randomisation test</a></li>
<li><a href="8-9-paired-randomisation-tests.html#plot-the-null-distribution"><span class="toc-section-number">8.9.3</span> Plot the null distribution</a></li>
<li><a href="8-9-paired-randomisation-tests.html#the-formal-hypothesis-test"><span class="toc-section-number">8.9.4</span> The formal hypothesis test</a></li>
</ul></li>
<li><a href="8-10-exercises-randomisation-tests.html#exercises---randomisation-tests"><span class="toc-section-number">8.10</span> Exercises - Randomisation tests</a>
<ul>
<li><a href="8-10-exercises-randomisation-tests.html#introduction-1"><span class="toc-section-number">8.10.1</span> Introduction</a></li>
<li><a href="8-10-exercises-randomisation-tests.html#your-task"><span class="toc-section-number">8.10.2</span> Your task</a></li>
</ul></li>
</ul></li>
<li><a href="9-comparing-two-means-with-a-t-test.html#comparing-two-means-with-a-t-test"><span class="toc-section-number">9</span> Comparing two means with a t-test</a>
<ul>
<li><a href="9-1-some-theory-.html#some-theory."><span class="toc-section-number">9.1</span> Some theory.</a></li>
<li><a href="9-2-one-sample-t-test.html#one-sample-t-test"><span class="toc-section-number">9.2</span> One sample t-test</a></li>
<li><a href="9-3-doing-it-by-hand-where-does-the-t-statistic-come-from.html#doing-it-by-hand---where-does-the-t-statistic-come-from"><span class="toc-section-number">9.3</span> Doing it “by hand” - where does the t-statistic come from?</a></li>
<li><a href="9-4-paired-t-test.html#paired-t-test"><span class="toc-section-number">9.4</span> Paired t-test</a></li>
<li><a href="9-5-a-paired-t-test-is-a-one-sample-test-.html#a-paired-t-test-is-a-one-sample-test."><span class="toc-section-number">9.5</span> A paired t-test is a one-sample test.</a></li>
<li><a href="9-6-two-sample-t-test.html#two-sample-t-test"><span class="toc-section-number">9.6</span> Two sample t-test</a></li>
<li><a href="9-7-t-tests-are-linear-models.html#t-tests-are-linear-models"><span class="toc-section-number">9.7</span> t-tests are linear models</a></li>
<li><a href="9-8-exercises-two-sample-t-test.html#exercises---two-sample-t-test"><span class="toc-section-number">9.8</span> Exercises - Two-sample t-test</a>
<ul>
<li><a href="9-8-exercises-two-sample-t-test.html#paired-t-test-1"><span class="toc-section-number">9.8.1</span> Paired t-test</a></li>
<li><a href="9-8-exercises-two-sample-t-test.html#optional-extra."><span class="toc-section-number">9.8.2</span> Optional extra.</a></li>
</ul></li>
</ul></li>
<li><a href="10-linear-models-with-a-single-categorical-explanatory-variable.html#linear-models-with-a-single-categorical-explanatory-variable"><span class="toc-section-number">10</span> Linear models with a single categorical explanatory variable</a>
<ul>
<li><a href="2-1-introduction.html#introduction"><span class="toc-section-number">10.1</span> Introduction</a></li>
<li><a href="10-2-one-way-anova.html#one-way-anova"><span class="toc-section-number">10.2</span> One-way ANOVA</a></li>
<li><a href="10-3-fitting-an-anova-in-r.html#fitting-an-anova-in-r"><span class="toc-section-number">10.3</span> Fitting an ANOVA in R</a></li>
<li><a href="10-4-where-are-the-differences.html#where-are-the-differences"><span class="toc-section-number">10.4</span> Where are the differences?</a></li>
<li><a href="10-5-tukeys-honestly-significant-difference-hsd.html#tukeys-honestly-significant-difference-hsd"><span class="toc-section-number">10.5</span> Tukey’s Honestly Significant Difference (HSD)</a></li>
<li><a href="10-6-anova-calculation-by-hand-optional.html#anova-calculation-by-hand-optional"><span class="toc-section-number">10.6</span> ANOVA calculation “by hand” (optional)</a></li>
</ul></li>
<li><a href="11-linear-models-with-a-several-categorical-explanatory-variables.html#linear-models-with-a-several-categorical-explanatory-variables"><span class="toc-section-number">11</span> Linear models with a several categorical explanatory variables</a>
<ul>
<li><a href="2-12-exercises-getting-acquainted-with-r.html#background"><span class="toc-section-number">11.1</span> Background</a></li>
<li><a href="11-2-fitting-a-two-way-anova-model.html#fitting-a-two-way-anova-model"><span class="toc-section-number">11.2</span> Fitting a two-way ANOVA model</a></li>
<li><a href="11-3-summarising-the-model-anova.html#summarising-the-model-anova"><span class="toc-section-number">11.3</span> Summarising the model (<code>anova</code>)</a></li>
<li><a href="11-4-summarising-the-model-summary.html#summarising-the-model-summary"><span class="toc-section-number">11.4</span> Summarising the model (<code>summary</code>)</a></li>
<li><a href="11-5-a-2-way-anova-on-a-fish-behaviour-study.html#a-2-way-anova-on-a-fish-behaviour-study"><span class="toc-section-number">11.5</span> A 2-way ANOVA on a fish behaviour study</a>
<ul>
<li><a href="11-5-a-2-way-anova-on-a-fish-behaviour-study.html#background-1"><span class="toc-section-number">11.5.1</span> Background</a></li>
<li><a href="8-10-exercises-randomisation-tests.html#your-task"><span class="toc-section-number">11.5.2</span> Your task</a></li>
</ul></li>
</ul></li>
<li><a href="12-linear-models-with-a-single-continuous-explanatory-variable.html#linear-models-with-a-single-continuous-explanatory-variable"><span class="toc-section-number">12</span> Linear models with a single continuous explanatory variable</a>
<ul>
<li><a href="2-12-exercises-getting-acquainted-with-r.html#background"><span class="toc-section-number">12.1</span> Background</a></li>
<li><a href="12-2-some-theory.html#some-theory"><span class="toc-section-number">12.2</span> Some theory</a></li>
<li><a href="12-3-evaluating-a-hypothesis-with-a-linear-regression-model.html#evaluating-a-hypothesis-with-a-linear-regression-model"><span class="toc-section-number">12.3</span> Evaluating a hypothesis with a linear regression model</a></li>
<li><a href="12-4-assumptions.html#assumptions"><span class="toc-section-number">12.4</span> Assumptions</a></li>
<li><a href="12-5-an-example-using-r.html#an-example-using-r"><span class="toc-section-number">12.5</span> An example using R</a></li>
<li><a href="12-6-exercises-linear-regression.html#exercises---linear-regression"><span class="toc-section-number">12.6</span> Exercises - Linear Regression</a>
<ul>
<li><a href="11-5-a-2-way-anova-on-a-fish-behaviour-study.html#background-1"><span class="toc-section-number">12.6.1</span> Background</a></li>
<li><a href="8-10-exercises-randomisation-tests.html#your-task"><span class="toc-section-number">12.6.2</span> Your task</a></li>
</ul></li>
</ul></li>
<li><a href="13-linear-models-with-categorical-and-continuous-explanatory-variables.html#linear-models-with-categorical-and-continuous-explanatory-variables"><span class="toc-section-number">13</span> Linear models with categorical and continuous explanatory variables</a>
<ul>
<li><a href="2-12-exercises-getting-acquainted-with-r.html#background"><span class="toc-section-number">13.1</span> Background</a></li>
<li><a href="13-2-the-height-hand-width-example-.html#the-height-hand-width-example."><span class="toc-section-number">13.2</span> The height ~ hand width example.</a></li>
<li><a href="13-3-summarising-with-anova.html#summarising-with-anova"><span class="toc-section-number">13.3</span> Summarising with <code>anova</code></a></li>
<li><a href="13-4-the-summary-of-coefficients-summary.html#the-summary-of-coefficients-summary"><span class="toc-section-number">13.4</span> The summary of coefficients (<code>summary</code>)</a></li>
<li><a href="13-5-simplifying-the-model.html#simplifying-the-model"><span class="toc-section-number">13.5</span> Simplifying the model</a></li>
</ul></li>
<li><a href="14-generalised-linear-models.html#generalised-linear-models"><span class="toc-section-number">14</span> Generalised linear models</a>
<ul>
<li><a href="14-1-count-data-with-poisson-errors-.html#count-data-with-poisson-errors."><span class="toc-section-number">14.1</span> Count data with Poisson errors.</a>
<ul>
<li><a href="14-1-count-data-with-poisson-errors-.html#example-number-of-offspring-in-foxes."><span class="toc-section-number">14.1.1</span> Example: Number of offspring in foxes.</a></li>
<li><a href="14-1-count-data-with-poisson-errors-.html#example-cancer-clusters"><span class="toc-section-number">14.1.2</span> Example: Cancer clusters</a></li>
</ul></li>
</ul></li>
<li><a href="15-extending-use-cases-of-glm.html#extending-use-cases-of-glm"><span class="toc-section-number">15</span> Extending use cases of GLM</a>
<ul>
<li><a href="15-1-logistic-regression-with-binary-01-data.html#logistic-regression-with-binary-01-data"><span class="toc-section-number">15.1</span> Logistic regression with binary (0/1) data</a></li>
<li><a href="15-2-example-species-presenceabsence-data.html#example-species-presenceabsence-data"><span class="toc-section-number">15.2</span> Example: species presence/absence data</a></li>
<li><a href="15-3-binomial-regression-with-proportionratio-data.html#binomial-regression-with-proportionratio-data"><span class="toc-section-number">15.3</span> Binomial regression with proportion/ratio data</a>
<ul>
<li><a href="15-3-binomial-regression-with-proportionratio-data.html#example-sex-ratios"><span class="toc-section-number">15.3.1</span> Example: sex ratios</a></li>
</ul></li>
</ul></li>
<li><a href="16-power-and-study-design.html#power-and-study-design"><span class="toc-section-number">16</span> Power and study design</a>
<ul>
<li><a href="16-1-power-analysis-by-simulation.html#power-analysis-by-simulation"><span class="toc-section-number">16.1</span> Power analysis by simulation</a></li>
</ul></li>
<li class="part"><span><b>IV Coming soon(ish)</b></span></li>
<li><a href="17-coming-soon-maybe.html#coming-soon-maybe"><span class="toc-section-number">17</span> Coming soon (maybe)!</a>
<ul>
<li><a href="17-1-multivariate-statistics.html#multivariate-statistics"><span class="toc-section-number">17.1</span> Multivariate statistics</a></li>
<li><a href="17-2-transforming-variables.html#transforming-variables"><span class="toc-section-number">17.2</span> Transforming variables</a></li>
<li><a href="17-3-non-linear-regression.html#non-linear-regression"><span class="toc-section-number">17.3</span> Non-linear regression</a></li>
<li><a href="17-4-nested-or-blocked-study-designs.html#nested-or-blocked-study-designs"><span class="toc-section-number">17.4</span> Nested or blocked study designs</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="combining-data-sets" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Combining data sets</h1>
<p>[INSERT PREAMBLE ABOUT DATA MANAGEMENT]</p>
<p>In this exercise you will learn how to combine two data sets to create a new one of combined data to answer a conservation-related question: “<strong>Does threat status vary with species’ generation times?</strong>”</p>
<p>This question is crucial to conservation biologists because it helps us to generalise our ideas about what drives extinction risks. In other words, if we can say “species with slow life histories tend to be more threatened” then this gives useful information that can help with planning. For example, imagine we have some species that have not yet been assessed (we don’t know if they are threatened or not). Should we focus attention on the one with a short generation time, or long generation time?</p>
<p>To answer this question we will need to import two large data sets, tidy them up a bit and then combine them for analysis.</p>
<p>Let’s start with the “Amniote Life History Database,”<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> which is a good source of life history data. We have encountered this database before. Recall that the missing values (which are normally coded as <code>NA</code> in R) are coded as “<code>-999</code>”. The easiest way to take care of this is to specify this when we import the data using the <code>na.strings</code> argument of the <code>read.csv</code> function. Thus we can import the data like this:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="4-combining-data-sets.html#cb146-1" aria-hidden="true"></a>amniote &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;CourseData/Amniote_Database_Aug_2015.csv&quot;</span>,<span class="dt">na.strings =</span> <span class="st">&quot;-999&quot;</span>)</span></code></pre></div>
<p>We first need to load the <code>tidyverse</code> packages.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="4-combining-data-sets.html#cb147-1" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p>We can filter on the taxonomic <code>class</code> to subset to only mammals. Then, to address our question, we want data on generation time for mammals. Generation time is often measured as the average age at which females reproduce so we can get close to that with <code>female_maturity_d</code>. We will first <code>select</code> these columns, along with <code>genus</code> and <code>species</code>. We can combine these two taxonomic variables using <code>mutate</code> and <code>paste</code> to get our latin binomial species name.</p>
<p>We have previously learned that log transforming such variables is a good thing to do, so we can use <code>mutate</code> again to do this transformation.</p>
<p>Finally, we can use <code>na.omit</code> to get rid of entries with missing values (which we cannot use). This is not essential, but keeps things more manageable.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="4-combining-data-sets.html#cb148-1" aria-hidden="true"></a>mammal &lt;-<span class="st"> </span>amniote <span class="op">%&gt;%</span></span>
<span id="cb148-2"><a href="4-combining-data-sets.html#cb148-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(class <span class="op">==</span><span class="st"> &quot;Mammalia&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#get the mammals only</span></span>
<span id="cb148-3"><a href="4-combining-data-sets.html#cb148-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(genus, species, female_maturity_d) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#get useful columns </span></span>
<span id="cb148-4"><a href="4-combining-data-sets.html#cb148-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">species =</span> <span class="kw">paste</span>(genus, species)) <span class="op">%&gt;%</span></span>
<span id="cb148-5"><a href="4-combining-data-sets.html#cb148-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>genus) <span class="op">%&gt;%</span></span>
<span id="cb148-6"><a href="4-combining-data-sets.html#cb148-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">logMaturity =</span> <span class="kw">log</span>(female_maturity_d)) <span class="op">%&gt;%</span></span>
<span id="cb148-7"><a href="4-combining-data-sets.html#cb148-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">na.omit</span>()</span></code></pre></div>
<p>Let’s take a quick look at what we have:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="4-combining-data-sets.html#cb149-1" aria-hidden="true"></a><span class="kw">head</span>(mammal)</span></code></pre></div>
<pre><code>##                      species female_maturity_d logMaturity
## 20         Echinops telfairi         278.42000    5.629131
## 22    Hemicentetes nigriceps          48.57000    3.883006
## 23 Hemicentetes semispinosus          46.19892    3.832956
## 27         Microgale dobsoni         669.59200    6.506669
## 40        Microgale talazaci         639.00000    6.459904
## 47           Setifer setosus         198.00000    5.288267</code></pre>
<p>Looks good. Now let’s import the IUCN Red List data.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="4-combining-data-sets.html#cb151-1" aria-hidden="true"></a>redlist &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;CourseData/MammalRedList.csv&quot;</span>)</span></code></pre></div>
<p>Let’s take a look at that.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="4-combining-data-sets.html#cb152-1" aria-hidden="true"></a><span class="kw">names</span>(redlist)</span></code></pre></div>
<pre><code>##  [1] &quot;Species.ID&quot;                &quot;Kingdom&quot;                   &quot;Phylum&quot;                    &quot;Class&quot;                    
##  [5] &quot;Order&quot;                     &quot;Family&quot;                    &quot;Genus&quot;                     &quot;Species&quot;                  
##  [9] &quot;Authority&quot;                 &quot;Infraspecific.rank&quot;        &quot;Infraspecific.name&quot;        &quot;Infraspecific.authority&quot;  
## [13] &quot;Stock.subpopulation&quot;       &quot;Synonyms&quot;                  &quot;Common.names..Eng.&quot;        &quot;Common.names..Fre.&quot;       
## [17] &quot;Common.names..Spa.&quot;        &quot;Red.List.status&quot;           &quot;Red.List.criteria&quot;         &quot;Red.List.criteria.version&quot;
## [21] &quot;Year.assessed&quot;             &quot;Population.trend&quot;          &quot;Petitioned&quot;</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="4-combining-data-sets.html#cb154-1" aria-hidden="true"></a><span class="kw">unique</span>(redlist<span class="op">$</span>Red.List.status)</span></code></pre></div>
<pre><code>## [1] &quot;DD&quot; &quot;LC&quot; &quot;CR&quot; &quot;NT&quot; &quot;EN&quot; &quot;VU&quot; &quot;EX&quot; &quot;EW&quot;</code></pre>
<p>There’s a lot of information there but what we really need is simply the latin binomial (for which we need <code>genus</code> and <code>species</code>) and the threat status <code>Red.List.status</code>.</p>
<p>R treats categorical variables (<code>factor</code> variables) as alphabetical, but in this case the red list status has a meaning going from low threat (Least Concern - LC) to Critically Endangered (CR) and even Extinct in the Wild (EX) at the other end of the spectrum. We can define this ordering using <code>mutate</code> with the <code>factor</code> function.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="4-combining-data-sets.html#cb156-1" aria-hidden="true"></a>redlist &lt;-<span class="st"> </span>redlist <span class="op">%&gt;%</span></span>
<span id="cb156-2"><a href="4-combining-data-sets.html#cb156-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">species =</span> <span class="kw">paste</span>(Genus, Species))<span class="op">%&gt;%</span></span>
<span id="cb156-3"><a href="4-combining-data-sets.html#cb156-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(species, Red.List.status) <span class="op">%&gt;%</span></span>
<span id="cb156-4"><a href="4-combining-data-sets.html#cb156-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Red.List.status =</span> <span class="kw">factor</span>(Red.List.status, </span>
<span id="cb156-5"><a href="4-combining-data-sets.html#cb156-5" aria-hidden="true"></a>                                  <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;LC&quot;</span>,<span class="st">&quot;NT&quot;</span>,<span class="st">&quot;VU&quot;</span>,<span class="st">&quot;EN&quot;</span>,<span class="st">&quot;CR&quot;</span>,<span class="st">&quot;EW&quot;</span>,<span class="st">&quot;EX&quot;</span>)))</span>
<span id="cb156-6"><a href="4-combining-data-sets.html#cb156-6" aria-hidden="true"></a></span>
<span id="cb156-7"><a href="4-combining-data-sets.html#cb156-7" aria-hidden="true"></a><span class="kw">head</span>(redlist)</span></code></pre></div>
<pre><code>##                species Red.List.status
## 1   Abditomys latidens            &lt;NA&gt;
## 2    Abeomelomys sevia              LC
## 3 Abrawayaomys ruschii              LC
## 4   Abrocoma bennettii              LC
## 5 Abrocoma boliviensis              CR
## 6      Abrocoma budini            &lt;NA&gt;</code></pre>
<p>Now we can combine this with the life history data from above using <code>left_join</code>.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="4-combining-data-sets.html#cb158-1" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">left_join</span>(mammal,redlist,<span class="dt">by =</span> <span class="st">&quot;species&quot;</span>)</span></code></pre></div>
<p>Let’s take a look at what we have now:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="4-combining-data-sets.html#cb159-1" aria-hidden="true"></a><span class="kw">head</span>(x)</span></code></pre></div>
<pre><code>##                     species female_maturity_d logMaturity Red.List.status
## 1         Echinops telfairi         278.42000    5.629131              LC
## 2    Hemicentetes nigriceps          48.57000    3.883006              LC
## 3 Hemicentetes semispinosus          46.19892    3.832956              LC
## 4         Microgale dobsoni         669.59200    6.506669              LC
## 5        Microgale talazaci         639.00000    6.459904              LC
## 6           Setifer setosus         198.00000    5.288267              LC</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="4-combining-data-sets.html#cb161-1" aria-hidden="true"></a><span class="kw">summary</span>(x)</span></code></pre></div>
<pre><code>##    species          female_maturity_d  logMaturity    Red.List.status
##  Length:2000        Min.   :  23.81   Min.   :3.170   LC     :1219   
##  Class :character   1st Qu.: 121.53   1st Qu.:4.800   VU     : 176   
##  Mode  :character   Median : 344.12   Median :5.841   EN     : 168   
##                     Mean   : 574.92   Mean   :5.745   NT     : 114   
##                     3rd Qu.: 696.38   3rd Qu.:6.546   CR     :  66   
##                     Max.   :6391.56   Max.   :8.763   (Other):  10   
##                                                       NA&#39;s   : 247</code></pre>
<p>You can see that there are 247 missing values for the Red List status. These are either species that have not yet been assessed, or maybe where there are mismatches in the species names between the two databases. We will ignore this problem today.</p>
<p>Before plotting, I will also use <code>filter</code> remove species that are extinct (status = “EX” and “EW”). To do this I use the <code>%in%</code> argument to allow me to match a vector of variables. Becuase I want to NOT match them I negate the match using <code>!</code>.</p>
<p>I then ensure that those levels are removed from the variable using <code>droplevels</code>.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="4-combining-data-sets.html#cb163-1" aria-hidden="true"></a>x &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span></span>
<span id="cb163-2"><a href="4-combining-data-sets.html#cb163-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>Red.List.status <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;EX&quot;</span>,<span class="st">&quot;EW&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb163-3"><a href="4-combining-data-sets.html#cb163-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">droplevels</span>()</span></code></pre></div>
<p>Let’s now plot the data to answer the question.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="4-combining-data-sets.html#cb164-1" aria-hidden="true"></a><span class="kw">plot</span>(x<span class="op">$</span>Red.List.status,x<span class="op">$</span>logMaturity,<span class="dt">ylab=</span><span class="st">&quot;Maturity&quot;</span>)</span></code></pre></div>
<p><img src="BB852_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<p>What can we see? If you focus on the median values, it looks like there is a weak positive relationship between this life history trait and threat status: animals with slower life histories tend to be more threatened.</p>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p><a href="https://esajournals.onlinelibrary.wiley.com/doi/10.1890/15-0846R.1" class="uri">https://esajournals.onlinelibrary.wiley.com/doi/10.1890/15-0846R.1</a><a href="4-combining-data-sets.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<p style="text-align: center;">
<a href="3-7-exercises-data-wrangling.html"><button class="btn btn-default">Previous</button></a>
<a href="4-1-exercise-joining-datasets.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>

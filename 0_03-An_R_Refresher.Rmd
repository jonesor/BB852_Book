# An R refresher

**Learning goals**

By the end of this chapter you should be able to:

- Use RStudio to run code from scripts.
- Create and inspect basic objects in R.
- Work with vectors and data frames.
- Import a CSV file using tidyverse tools.
- Make simple plots and summaries.

**Prerequisites**

- You have R and RStudio installed.

**A tiny motivating example**

Let’s make a tiny plot so we know everything is working.

```{r 0-03-An-R-Refresher-1, message=FALSE}
library(tidyverse)

mydata <- data.frame(
  body_length_cm = c(4.2, 5.1, 5.6, 6.8, 7.4),
  body_mass_g = c(9.5, 12.1, 14.0, 18.2, 21.5)
)

ggplot(mydata, aes(x = body_length_cm, y = body_mass_g)) +
  geom_point()
```

**What just happened:** Each point is an individual. This matters because almost every plot in this course follows the same pattern: **data + aesthetics + geom**.

**Try this:** Change one value and re-run. What changes on the plot?

---

## Getting started with RStudio

**What we’re about to do:** We will set up a simple workflow so your work is reproducible.

RStudio is not R itself. It is the interface where you write scripts, run code, and view results.

```{block 0-03-An-R-Refresher-2, type="do-something"}
**Do this:** Open RStudio and create a new script (`File > New File > R Script`). Save it as `practice.R`.
```

**Why this matters:** Scripts let you save, revisit, and debug your work. Copy-pasting into the console will not scale.

**Common mistake:** Running everything in the console and losing your work. If this happens, start a script and re-run your commands there.

**Takeaway:** Work in scripts, not just the console.

---

## Getting help

**What we’re about to do:** Learn how to ask R for help.

```{r 0-03-An-R-Refresher-3, eval=FALSE}
?rep
help.search("bar plot")
??"bar plot"
```

**What just happened:** `?` opens a help page when you know a function name; `??` searches when you do not.

**Try this:** Look up `mean` or `plot` and read the arguments section.

**Takeaway:** R has built-in help for almost everything.

---

## R as a calculator

**What we’re about to do:** Use R for basic arithmetic and logic.

```{r 0-03-An-R-Refresher-4}
4 + 3
9 - 12
6 / 3
7 * 3
(2 * 7) + 2 - 0.4
```

```{r 0-03-An-R-Refresher-5}
sqrt(945)
3^5
abs(-23.4)
round(2.35425, digits = 2)
log(1.2)
exp(1)
log10(6)
```

Logical comparisons:

```{r 0-03-An-R-Refresher-6}
3 < 10
5 > 7
5 == 5
6 != 5
3 %in% c(1, 2, 3, 4, 5)
6 %in% c(1, 2, 3, 4, 5)
```

**Takeaway:** R handles arithmetic and logical tests directly.

---

## Objects and vectors

**What we’re about to do:** Create objects and simple vectors.

```{r 0-03-An-R-Refresher-7}
x <- 4
x
```

Vectors are simple sequences of values.

```{r 0-03-An-R-Refresher-8}
A <- 1:5
B <- c(1, 3, 6, 1, 7, 9)
C <- seq(1, 12, 2)
D <- seq(1, 5, 0.1)
E <- rep(c("Male", "Female"), each = 3)
G <- rep(c("Male", "Female"), c(2, 4))
```

```{block 0-03-An-R-Refresher-9, type="do-something"}
Try changing `seq()` or `rep()` arguments. What changes?
```

**Common mistake:** Forgetting `c()` when creating a list of values.

**Takeaway:** Vectors are the building blocks of most data in R.

---

## Manipulating vectors

**What we’re about to do:** Do arithmetic on vectors.

```{r 0-03-An-R-Refresher-10}
B
B * 3
B - 2
c(A, B)
B * c(1, 2, 3, 4, 5, 6)
A / B
```

**What just happened:** R works element-by-element when vector lengths match.

**Takeaway:** Vectorised operations are fast and convenient.

---

## Missing values, infinity, and NaN

**What we’re about to do:** See how R handles missing values and edge cases.

```{r 0-03-An-R-Refresher-11}
mean(c(1, 3, 6, 1, 7, 9, NA))
mean(c(1, 3, 6, 1, 7, 9, NA), na.rm = TRUE)
```

```{r 0-03-An-R-Refresher-12}
5 / 0
-4 / 0
0 / 0
Inf - Inf
```

**Takeaway:** Use `na.rm = TRUE` when you want to ignore missing values.

---

## Data frames

**What we’re about to do:** Create and inspect a data frame.

```{r 0-03-An-R-Refresher-13}
height <- c(173, 145, 187, 155, 179, 133)
sex <- c("Male", "Female", "Male", "Female", "Male", "Female")
age <- c(17, 22, 32, 20, 27, 30)

mydata <- data.frame(height = height, age = age, sex = sex)
mydata
```

Inspect a data frame:

```{r 0-03-An-R-Refresher-14}
summary(mydata)
str(mydata)
```

Subset rows/columns:

```{r 0-03-An-R-Refresher-15}
mydata[1, ]
mydata[, 2]
mydata[1, 2]
subset(mydata, sex == "Female")
```

**Takeaway:** Data frames are tables: rows are observations, columns are variables.

---

## Classes and factors

**What we’re about to do:** Check classes and use factors for categories.

```{r 0-03-An-R-Refresher-16}
class(height)
class(sex)
class(mydata)
```

Some functions need categorical data to be factors:

```{r 0-03-An-R-Refresher-17, eval = FALSE}
plot(mydata$sex, mydata$age)
```

```{r 0-03-An-R-Refresher-18}
plot(as.factor(mydata$sex), mydata$age)
```

```{r 0-03-An-R-Refresher-19}
mydata$sex <- as.factor(mydata$sex)
str(mydata)
```

**Common mistake:** Forgetting to convert characters to factors for categorical plots.

**Takeaway:** Use factors for categorical variables when needed.

---

## Organising your work and importing data

**What we’re about to do:** Import a CSV file using tidyverse tools.

Keep your data in a `CourseData` folder inside your project. We will use **relative paths** throughout this course. If you do not have `CourseData`, download it from the course site.

```{r 0-03-An-R-Refresher-20}
carni <- readr::read_csv("CourseData/carnivora.csv")
```

**What just happened:** `read_csv()` imported the data and guessed column types.

**Try this:** Run `glimpse(carni)` and compare it to `summary(carni)`.

**Common mistake:** File not found. Check spelling and folder names.

**Takeaway:** `read_csv()` is the tidyverse way to import CSV files.

---

## Inspecting the data

```{r 0-03-An-R-Refresher-21}
summary(carni)
dim(carni)
names(carni)
```

The dataset includes life history variables. For example:

- `FW` = Female body weight (kg)
- `GL` = Gestation length (days)
- `BW` = Birth weight (g)

```{r 0-03-An-R-Refresher-22}
summary(carni$FW)
```

---

## Tables and summary statistics

```{r 0-03-An-R-Refresher-23}
class(carni$Family)
levels(as.factor(carni$Family))
```

```{r 0-03-An-R-Refresher-24}
table(carni$Family)
tapply(carni$FW, carni$Family, mean, na.rm = TRUE)
```

**Takeaway:** Tables and summaries give you a quick sense of patterns before you plot.

---

## Basic plotting

```{r 0-03-An-R-Refresher-25, fig.cap=('A simple scatter plot'), fig.show=('asis')}
plot(log(carni$FW), log(carni$GL))
```

**Interpretation:** Species with larger female body mass tend to have longer gestation lengths.

- **What to look for:**
  - Is the relationship roughly linear?
  - Are there any clear outliers?

**Try this:** Remove the log and compare the shape.

---

## R packages

Packages extend base R. Install once, then load each session.

```{r 0-03-An-R-Refresher-26, eval=FALSE}
install.packages("tidyverse")
```

```{r 0-03-An-R-Refresher-27}
library(tidyverse)
```

```{block 0-03-An-R-Refresher-28, type="do-something"}
Add your `library(...)` calls at the top of scripts so your code runs every time.
```

---

## Exercise: Californian bird diversity

Surveys on bird abundances were carried out near Oakland, California.^[Vale, T. R., & Vale, G. R. (1976). Suburban bird populations in west-central California. Journal of Biogeography, 157–165.] The locations were of different ages, which lets us ask how species richness changes through time.

### The data

The file is `suburbanBirds.csv`. Columns: `Name`, `Year`, `HabitatIndex`, `nIndividuals`, `nSpecies`.

### Your tasks

**Level 1 (warm-up)**

1. Import the data and check the columns with `str()`.
   **Checkpoint:** You should see the five columns listed above.

2. Calculate the mean, minimum, and maximum of `nSpecies`.
   **Checkpoint:** You should get three numbers.

**Level 2 (practice)**

3. Create a new column `Age = 1975 - Year` and check it looks sensible.
   **Checkpoint:** Younger suburbs have smaller `Age` values.

4. Plot `Age` vs `nSpecies` with `plot()`.
   **Checkpoint:** The x-axis is age and the y-axis is species richness.

**Level 3 (extension)**

5. Re-plot with a smoother (e.g. `lines(lowess(Age, nSpecies))`). Does it change your interpretation?

**Hint:** If your plot is empty, check your column names with `names()`.

---

## Key takeaways

- Use scripts for reproducible work.
- Vectors and data frames are the core data types.
- `read_csv()` is the tidyverse way to import CSV files.
- Check classes with `str()` and convert to `factor()` when needed.
- Always inspect your data before analysing it.

## Common pitfalls recap

- Running code only in the console.
- File paths that point to the wrong folder.
- Treating categories as numbers or characters when they should be factors.

## Mini-project

Pick one dataset from `CourseData` and write a short script that:

1. Imports the data.
2. Summarises one column with `summary()`.
3. Produces a simple plot.

Write 3–4 sentences describing what you found.
